# BidFlow â€” ì¸ì¦ Â· ì„¸ì…˜ Â· DB Â· íŒ€ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ êµ¬í˜„ ì •ë¦¬

> ì‘ì„±ì¼: 2026-02-25 / ë¸Œëœì¹˜: `feature/bykim`

---

## ëª©ì°¨

1. [ì „ì²´ êµ¬ì¡° ê°œìš”](#1-ì „ì²´-êµ¬ì¡°-ê°œìš”)
2. [SQLite DB í…Œì´ë¸” êµ¬ì¡°](#2-sqlite-db-í…Œì´ë¸”-êµ¬ì¡°)
3. [ì¸ì¦ / ë¡œê·¸ì¸](#3-ì¸ì¦--ë¡œê·¸ì¸)
4. [ì„¸ì…˜ ê´€ë¦¬](#4-ì„¸ì…˜-ê´€ë¦¬)
5. [íŒ€ ì›Œí¬ìŠ¤í˜ì´ìŠ¤](#5-íŒ€-ì›Œí¬ìŠ¤í˜ì´ìŠ¤)
6. [ë©€í‹° í…Œë„Œì‹œ ê²©ë¦¬](#6-ë©€í‹°-í…Œë„Œì‹œ-ê²©ë¦¬)
7. [íŒ€ì¥ / íŒ€ì› ì—­í•  ë¶„ë¦¬](#7-íŒ€ì¥--íŒ€ì›-ì—­í• -ë¶„ë¦¬)

---

## 1. ì „ì²´ êµ¬ì¡° ê°œìš”

```
ì‚¬ìš©ì
  â”‚
  â–¼
Home.py (ì•± ì§„ì…ì )
  â”œâ”€â”€ DB ì´ˆê¸°í™” (init_db)
  â”œâ”€â”€ ë¡œê·¸ì¸ / íšŒì›ê°€ì… íƒ­
  â””â”€â”€ ì¸ì¦ ì„±ê³µ ì‹œ â†’ ê¸°ëŠ¥ í˜ì´ì§€
          â”‚
          â”œâ”€â”€ 1_Upload      : ë¬¸ì„œ ì—…ë¡œë“œ Â· ì¶”ì¶œ â†’ documents / extraction_results í…Œì´ë¸”
          â”œâ”€â”€ 2_Matrix      : ì¶”ì¶œ ê²°ê³¼ ì¡°íšŒ
          â”œâ”€â”€ 3_Profile     : íšŒì‚¬ í”„ë¡œí•„ ì¡°íšŒÂ·ìˆ˜ì • â†’ profiles í…Œì´ë¸”
          â”œâ”€â”€ 4_Decision    : ì…ì°° ì ê²© íŒì •
          â”œâ”€â”€ 5_Eval        : í‰ê°€
          â””â”€â”€ 6_Team Workspace : íŒ€ ì½”ë©˜íŠ¸ â†’ comments / replies í…Œì´ë¸”
```

**í•µì‹¬ íë¦„**: ëª¨ë“  í˜ì´ì§€ëŠ” ë¡œê·¸ì¸ â†’ ì„¸ì…˜ ë³µì› â†’ ê¸°ëŠ¥ ìˆ˜í–‰ ìˆœì„œë¡œ ë™ì‘í•©ë‹ˆë‹¤.
ì¸ì¦ëœ `user_id`ê°€ ëª¨ë“  ë°ì´í„° ì¡°íšŒÂ·ì €ì¥ì˜ ê¸°ì¤€ì´ ë©ë‹ˆë‹¤.

---

## 2. SQLite DB í…Œì´ë¸” êµ¬ì¡°

**DB íŒŒì¼**: `data/bidflow.db` (WAL ëª¨ë“œ, gitignore ì ìš©)

ì•± ì‹œì‘ ì‹œ ìë™ìœ¼ë¡œ í…Œì´ë¸”ì„ ìƒì„±í•˜ë©°, ìŠ¤í‚¤ë§ˆ ë³€ê²½ì´ ìˆìœ¼ë©´ ìë™ ë§ˆì´ê·¸ë ˆì´ì…˜í•©ë‹ˆë‹¤.

---

### users â€” ê³„ì • ì •ë³´

| ì»¬ëŸ¼ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `username` | TEXT (PK) | ë¡œê·¸ì¸ ID |
| `name` | TEXT | í‘œì‹œ ì´ë¦„ |
| `email` | TEXT | ì´ë©”ì¼ |
| `password_hash` | TEXT | bcrypt í•´ì‹œ |
| `team` | TEXT | ì†Œì† íŒ€ëª… (ë¯¸ì†Œì†ì´ë©´ ë¹ˆ ë¬¸ìì—´) |
| `role` | TEXT | ì—­í• : `member` \| `leader` (ê¸°ë³¸ê°’: `member`) |
| `created_at` | TEXT | ê°€ì…ì¼ì‹œ (ìë™) |

---

### documents â€” RFP ë¬¸ì„œ

| ì»¬ëŸ¼ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `doc_hash` | TEXT (PK) | íŒŒì¼ MD5 í•´ì‹œ |
| `user_id` | TEXT (PK) | ì—…ë¡œë” (ë³µí•© PK) |
| `filename` | TEXT | íŒŒì¼ëª… |
| `file_path` | TEXT | ì›ë³¸ íŒŒì¼ ê²½ë¡œ |
| `status` | TEXT | ì²˜ë¦¬ ìƒíƒœ (ê¸°ë³¸ê°’: `READY`) |
| `upload_date` | TEXT | ì—…ë¡œë“œ ì¼ì‹œ |
| `content_json` | TEXT | íŒŒì‹±ëœ ì²­í¬Â·í…Œì´ë¸” ì „ì²´ JSON |

ë™ì¼ íŒŒì¼ì„ ë‘ ì‚¬ìš©ìê°€ ê°ì ì—…ë¡œë“œí•˜ë©´ `(doc_hash, user_id)` ë³µí•© PKë¡œ ë³„ê°œ í–‰ì´ ë©ë‹ˆë‹¤.

---

### extraction_results â€” Compliance Matrix ì¶”ì¶œ ê²°ê³¼

| ì»¬ëŸ¼ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `doc_hash` | TEXT (PK) | ë¬¸ì„œ í•´ì‹œ |
| `user_id` | TEXT (PK) | ì†Œìœ ì (ë³µí•© PK) |
| `result_json` | TEXT | g1~g4 ê·¸ë£¹ ì¶”ì¶œ ê²°ê³¼ JSON |
| `created_at` | TEXT | ì €ì¥ ì¼ì‹œ (ìë™) |

---

### profiles â€” íšŒì‚¬ í”„ë¡œí•„

| ì»¬ëŸ¼ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `owner_key` | TEXT (PK) | íŒ€ ì†Œì†ì´ë©´ `team_name`, ë¯¸ì†Œì†ì´ë©´ `user_id` |
| `profile_json` | TEXT | íšŒì‚¬ ì •ë³´ JSON (ì´ë¦„, ì§€ì—­, ì‹ ìš©ë“±ê¸‰, ë©´í—ˆ ë“±) |
| `updated_at` | TEXT | ë§ˆì§€ë§‰ ìˆ˜ì • ì¼ì‹œ |

íŒ€ ì†Œì† ì‚¬ìš©ìëŠ” íŒ€ë‹¹ í•˜ë‚˜ì˜ ê³µìœ  í”„ë¡œí•„ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
íŒ€ì¥ë§Œ ìˆ˜ì • ê°€ëŠ¥í•˜ë©°, íŒ€ì›ì€ ì½ê¸°ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.

---

### sessions â€” ì„¸ì…˜ ìƒíƒœ

| ì»¬ëŸ¼ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `user_id` | TEXT (PK) | ì‚¬ìš©ì ID |
| `current_doc_hash` | TEXT | ë§ˆì§€ë§‰ìœ¼ë¡œ ì‘ì—…í•œ ë¬¸ì„œ í•´ì‹œ |
| `extra_json` | TEXT | ê¸°íƒ€ ì„¸ì…˜ ì •ë³´ |
| `updated_at` | TEXT | ê°±ì‹  ì¼ì‹œ |

ë¸Œë¼ìš°ì €ë¥¼ ë‹«ì•˜ë‹¤ê°€ ì¬ì ‘ì†í•´ë„ ë§ˆì§€ë§‰ ì‘ì—… ë¬¸ì„œì™€ ì¶”ì¶œ ê²°ê³¼ë¥¼ ìë™ ë³µì›í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.

---

### comments â€” íŒ€ ì½”ë©˜íŠ¸

| ì»¬ëŸ¼ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `id` | TEXT (PK) | UUID |
| `team_name` | TEXT | ì†Œì† íŒ€ |
| `doc_hash` | TEXT | ëŒ€ìƒ ë¬¸ì„œ |
| `author` | TEXT | ì‘ì„±ì username |
| `author_name` | TEXT | ì‘ì„±ì í‘œì‹œ ì´ë¦„ |
| `text` | TEXT | ì½”ë©˜íŠ¸ ë‚´ìš© |
| `created_at` | TEXT | ì‘ì„± ì¼ì‹œ |

`(team_name, doc_hash)` ì¸ë±ìŠ¤ê°€ ìˆì–´ íŠ¹ì • íŒ€+ë¬¸ì„œì˜ ì½”ë©˜íŠ¸ë¥¼ ë¹ ë¥´ê²Œ ì¡°íšŒí•©ë‹ˆë‹¤.

---

### replies â€” ì½”ë©˜íŠ¸ ë‹µê¸€

| ì»¬ëŸ¼ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `id` | TEXT (PK) | UUID |
| `comment_id` | TEXT (FK) | ë¶€ëª¨ ì½”ë©˜íŠ¸ ID (ON DELETE CASCADE) |
| `author` | TEXT | ì‘ì„±ì username |
| `author_name` | TEXT | ì‘ì„±ì í‘œì‹œ ì´ë¦„ |
| `text` | TEXT | ë‹µê¸€ ë‚´ìš© |
| `created_at` | TEXT | ì‘ì„± ì¼ì‹œ |

ì½”ë©˜íŠ¸ê°€ ì‚­ì œë˜ë©´ ì—°ê²°ëœ ë‹µê¸€ë„ ìë™ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤ (CASCADE).

---

## 3. ì¸ì¦ / ë¡œê·¸ì¸

**ê´€ë ¨ íŒŒì¼**: `src/bidflow/apps/ui/auth.py`

### ë¡œê·¸ì¸ ë™ì‘

ì‚¬ìš©ì ê³„ì •ì€ `users` í…Œì´ë¸”ì— ì €ì¥ë©ë‹ˆë‹¤.
ë¡œê·¸ì¸ ì‹œ DBì—ì„œ ì „ì²´ ê³„ì • ëª©ë¡ì„ ì½ì–´ `streamlit-authenticator`ì— ì „ë‹¬í•˜ê³ ,
bcrypt í•´ì‹œ ê²€ì¦ì„ í†µí•´ ì¸ì¦í•©ë‹ˆë‹¤. ì¸ì¦ ì„±ê³µ ì‹œ ì¿ í‚¤ì— ì„¸ì…˜ì´ ì €ì¥ë˜ì–´
ì´í›„ ì¬ë°©ë¬¸ ì‹œ ìë™ ë¡œê·¸ì¸ë©ë‹ˆë‹¤.

| ë‹¨ê³„ | ë™ì‘ |
|------|------|
| ì•± ì§„ì… | ì¿ í‚¤ í™•ì¸ â†’ ìœ íš¨í•˜ë©´ ìë™ ë¡œê·¸ì¸ |
| ì¿ í‚¤ ì—†ìŒ | ì‚¬ì´ë“œë°”ì— ë¡œê·¸ì¸ í¼ í‘œì‹œ |
| ì…ë ¥ ê²€ì¦ | DBì˜ bcrypt í•´ì‹œì™€ ë¹„êµ |
| ì„±ê³µ | `username`ì„ ì´í›„ ëª¨ë“  í˜ì´ì§€ì—ì„œ ì‚¬ìš© |
| ì‹¤íŒ¨ | ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ, `st.stop()` |

### íšŒì›ê°€ì… ë™ì‘

| ë‹¨ê³„ | ë™ì‘ |
|------|------|
| í¼ ì…ë ¥ | ì‚¬ìš©ìëª…, ì´ë¦„, ì´ë©”ì¼, íŒ€, **ì—­í• (íŒ€ì›/íŒ€ì¥)**, ë¹„ë°€ë²ˆí˜¸ |
| ìœ íš¨ì„± ê²€ì‚¬ | ì¤‘ë³µ ID í™•ì¸, ì •ê·œì‹, ë¹„ë°€ë²ˆí˜¸ ê¸¸ì´Â·ì¼ì¹˜ ì—¬ë¶€ |
| ì €ì¥ | ë¹„ë°€ë²ˆí˜¸ë¥¼ bcrypt í•´ì‹œë¡œ ë³€í™˜í•´ `users` í…Œì´ë¸”ì— ì €ì¥ |
| ê³µê°„ ìƒì„± | `data/accounts/{username}/` í•˜ìœ„ ë””ë ‰í† ë¦¬ ìë™ ìƒì„± |

### ê³„ì • ê´€ë¦¬

- **ë¡œê·¸ì•„ì›ƒ**: ì‚¬ì´ë“œë°”ì—ì„œ ë²„íŠ¼ í´ë¦­ â†’ ì¿ í‚¤ ì‚­ì œ
- **íšŒì› íƒˆí‡´**: ì‚¬ì´ë“œë°” ê³„ì • ì„¤ì • â†’ í™•ì¸ ë‹¨ê³„ í›„ DBì—ì„œ ê³„ì • ì‚­ì œ. ì„ íƒì ìœ¼ë¡œ ì‚¬ìš©ì ë°ì´í„° íŒŒì¼ë„ í•¨ê»˜ ì‚­ì œ ê°€ëŠ¥
- **íŒ€ ì •ë³´**: ì‚¬ì´ë“œë°”ì— ì†Œì† íŒ€ëª… í‘œì‹œ

### FastAPI ì¸ì¦

API ìš”ì²­ì€ `X-API-Key` í—¤ë”ë¡œ ì¸ì¦í•©ë‹ˆë‹¤.
`.env`ì˜ `BIDFLOW_API_KEYS`ì—ì„œ `APIí‚¤:username` ë§¤í•‘ì„ ì½ì–´ user_idë¥¼ ê²°ì •í•©ë‹ˆë‹¤.

---

## 4. ì„¸ì…˜ ê´€ë¦¬

**ê´€ë ¨ íŒŒì¼**: `src/bidflow/apps/ui/session.py`

### ì—­í• 

Streamlitì€ ë¸Œë¼ìš°ì € íƒ­ì„ ë‹«ìœ¼ë©´ ë©”ëª¨ë¦¬ ìƒíƒœê°€ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.
`init_app_session(user_id)`ëŠ” ì•± ì¬ì ‘ì† ì‹œ DBì—ì„œ ì´ì „ ì‘ì—… ë‚´ìš©ì„ ë³µì›í•©ë‹ˆë‹¤.
ëª¨ë“  ê¸°ëŠ¥ í˜ì´ì§€ì—ì„œ ë¡œê·¸ì¸ ì§í›„ ê³µí†µìœ¼ë¡œ í˜¸ì¶œë©ë‹ˆë‹¤.

### ë³µì› í•­ëª©

| í•­ëª© | ë³µì› ì¡°ê±´ | ì €ì¥ ìœ„ì¹˜ |
|------|-----------|-----------|
| ë§ˆì§€ë§‰ ì‘ì—… ë¬¸ì„œ | `sessions` í…Œì´ë¸”ì— ê¸°ë¡ì´ ìˆê³  í•´ë‹¹ ë¬¸ì„œê°€ DBì— ì¡´ì¬í•  ë•Œ | `sessions.current_doc_hash` |
| ì¶”ì¶œ ê²°ê³¼ (Matrix) | í•´ë‹¹ ë¬¸ì„œì˜ ì¶”ì¶œ ê²°ê³¼ê°€ ìˆì„ ë•Œ | `extraction_results` |
| íšŒì‚¬ í”„ë¡œí•„ | `profiles`ì— ê¸°ë¡ì´ ìˆì„ ë•Œ (ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ì‚¬ìš©) | `profiles` |

### ì €ì¥ ì‹œì 

| ì´ë²¤íŠ¸ | ì €ì¥ ë‚´ìš© |
|--------|-----------|
| ë¬¸ì„œ ì—…ë¡œë“œ ì™„ë£Œ | `sessions`ì— `current_doc_hash` ê¸°ë¡ |
| ì¶”ì¶œ ì™„ë£Œ | `extraction_results`ì— Matrix ì €ì¥ |
| í”„ë¡œí•„ ìˆ˜ì • ì €ì¥ | `profiles`ì— ê°±ì‹  |

---

## 5. íŒ€ ì›Œí¬ìŠ¤í˜ì´ìŠ¤

**ê´€ë ¨ íŒŒì¼**: `src/bidflow/apps/ui/team.py`, `pages/6_Team_Workspace.py`

### ì§„ì… ì¡°ê±´

ë¡œê·¸ì¸ í›„ íŒ€ ì†Œì†ì´ ìˆì–´ì•¼ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.
íŒ€ ë¯¸ì†Œì† ê³„ì •ì€ ì•ˆë‚´ ë©”ì‹œì§€ì™€ í•¨ê»˜ ì ‘ê·¼ì´ ì°¨ë‹¨ë©ë‹ˆë‹¤.

### í™”ë©´ êµ¬ì„±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Team Workspace                                      â”‚
â”‚ íŒ€: team_ai  |  íŒ€ì›: testi, team_leader            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì•ˆê±´ ì„ íƒ â–¼  [ íŒŒì¼ëª… (by ì—…ë¡œë”, ì—…ë¡œë“œì¼) ]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì•ˆê±´ ì •ë³´            â”‚ íŒì • ê²°ê³¼                     â”‚
â”‚ íŒŒì¼ëª…: â€¦            â”‚ âš  ì¡°ê±´ë¶€ ì…ì°° ê°€ëŠ¥            â”‚
â”‚ ì—…ë¡œë”: â€¦            â”‚ RED:2  GRAY:3  GREEN:5        â”‚
â”‚ ë‚ ì§œ: â€¦              â”‚                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ íŒ€ ì½”ë©˜íŠ¸                                           â”‚
â”‚ [ì½”ë©˜íŠ¸ ì‘ì„± í¼]                                    â”‚
â”‚                                                     â”‚
â”‚  Alice â€¢ 14:30                               ğŸ—‘     â”‚
â”‚  "ë‚©í’ˆ ì‹¤ì  ê¸°ì¤€ì´ ë„ˆë¬´ ë†’ìŠµë‹ˆë‹¤."                  â”‚
â”‚    â†³ Bob â€¢ 14:45  "ë™ì˜í•©ë‹ˆë‹¤."              ğŸ—‘     â”‚
â”‚    [ë‹µê¸€ ë‹¬ê¸°]                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì½”ë©˜íŠ¸ ë™ì‘

| ê¸°ëŠ¥ | ë™ì‘ |
|------|------|
| ì½”ë©˜íŠ¸ ì‘ì„± | ê°™ì€ íŒ€ ì†Œì†ì´ë©´ ëˆ„êµ¬ë‚˜ ì‘ì„± ê°€ëŠ¥ |
| ë‹µê¸€ ì‘ì„± | ì½”ë©˜íŠ¸ ë‹¨ìœ„ë¡œ ë‹µê¸€ ë‹¬ê¸° ê°€ëŠ¥ |
| ì‚­ì œ | ë³¸ì¸ì´ ì‘ì„±í•œ ì½”ë©˜íŠ¸Â·ë‹µê¸€ë§Œ ì‚­ì œ ê°€ëŠ¥ (DB ë ˆë²¨ ê°•ì œ) |
| ì½”ë©˜íŠ¸ ì‚­ì œ ì‹œ | ì—°ê²°ëœ ë‹µê¸€ ì „ì²´ ìë™ ì‚­ì œ (CASCADE) |
| ì¡°íšŒ ë²”ìœ„ | ê°™ì€ íŒ€ + ê°™ì€ ë¬¸ì„œì˜ ì½”ë©˜íŠ¸ë§Œ í‘œì‹œ |

### ë¬¸ì„œ ëª©ë¡

íŒ€ì› ê°ìì˜ `documents` í…Œì´ë¸”ì„ í•©ì‚°í•´ íŒ€ ì „ì²´ ë¬¸ì„œë¥¼ í•˜ë‚˜ì˜ ëª©ë¡ìœ¼ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.
ì—…ë¡œë” ì´ë¦„ê³¼ ì—…ë¡œë“œ ë‚ ì§œë¥¼ í•¨ê»˜ ë³´ì—¬ì¤ë‹ˆë‹¤.

### íŒì • ê²°ê³¼

ë¬¸ì„œ ì—…ë¡œë”ì˜ íšŒì‚¬ í”„ë¡œí•„ + ì¶”ì¶œ ê²°ê³¼ë¥¼ ê¸°ë°˜ìœ¼ë¡œ íŒì • ì‹ í˜¸(RED/GRAY/GREEN)ë¥¼ ì‚°ì¶œí•©ë‹ˆë‹¤.
ì¶”ì¶œì´ ë¯¸ì™„ë£Œë˜ì—ˆê±°ë‚˜ í”„ë¡œí•„ì´ ì—†ìœ¼ë©´ "íŒì • ê²°ê³¼ ì—†ìŒ"ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.

---

## 6. ë©€í‹° í…Œë„Œì‹œ ê²©ë¦¬

BidFlowëŠ” ì‚¬ìš©ìë³„ ì™„ì „ ê²©ë¦¬ ì›ì¹™ìœ¼ë¡œ ì„¤ê³„ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
í•œ ì‚¬ìš©ìì˜ ë¬¸ì„œÂ·ë²¡í„°DBÂ·ì¶”ì¶œ ê²°ê³¼ê°€ ë‹¤ë¥¸ ì‚¬ìš©ìì—ê²Œ ì ˆëŒ€ ë…¸ì¶œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

### ê²©ë¦¬ ê³„ì¸µ

| ê³„ì¸µ | ê²©ë¦¬ ë°©ì‹ |
|------|-----------|
| **íŒŒì¼ì‹œìŠ¤í…œ** | `data/accounts/{user_id}/` í•˜ìœ„ ë””ë ‰í† ë¦¬ ë¶„ë¦¬ |
| **VectorDB** | ChromaDB ì»¬ë ‰ì…˜ ì´ë¦„ `bidflow_rfp_{user_id}`ë¡œ ë¶„ë¦¬ |
| **SQLite** | `documents`, `extraction_results` í…Œì´ë¸”ì˜ `user_id` ì»¬ëŸ¼ + ë³µí•© PK |

### íŒŒì¼ì‹œìŠ¤í…œ êµ¬ì¡°

```
data/
â”œâ”€â”€ bidflow.db
â”œâ”€â”€ accounts/
â”‚   â”œâ”€â”€ alice/
â”‚   â”‚   â”œâ”€â”€ raw/         â† alice ì—…ë¡œë“œ ì›ë³¸ íŒŒì¼
â”‚   â”‚   â”œâ”€â”€ processed/   â† (ë ˆê±°ì‹œ, ë¯¸ì‚¬ìš©)
â”‚   â”‚   â””â”€â”€ vectordb/    â† alice ì „ìš© ChromaDB
â”‚   â””â”€â”€ bob/
â”‚       â”œâ”€â”€ raw/
â”‚       â””â”€â”€ vectordb/    â† bob ì „ìš© ChromaDB
â””â”€â”€ shared/
    â”œâ”€â”€ raw/
    â”œâ”€â”€ knowledge/
    â””â”€â”€ templates/
```

### ê²©ë¦¬ ë³´ì¥ ì›ì¹™

| ì›ì¹™ | ë°©ë²• |
|------|------|
| ë¬¸ì„œëŠ” ì—…ë¡œë”ë§Œ ì¡°íšŒ ê°€ëŠ¥ | `user_id` ì»¬ëŸ¼ìœ¼ë¡œ DB í•„í„°ë§ |
| RAG ê²€ìƒ‰ì€ ë³¸ì¸ ë¬¸ì„œë§Œ ëŒ€ìƒ | ChromaDB ì»¬ë ‰ì…˜ ë¶„ë¦¬ |
| íŒ€ ì½”ë©˜íŠ¸ëŠ” ê°™ì€ íŒ€ë§Œ ì—´ëŒ | ë¡œê·¸ì¸ í›„ íŒ€ ì†Œì† í™•ì¸ |
| ì½”ë©˜íŠ¸ ì‚­ì œëŠ” ì‘ì„±ìë§Œ ê°€ëŠ¥ | `author = ?` ì¡°ê±´ì„ DB ì¿¼ë¦¬ì— ê°•ì œ |
| API ì ‘ê·¼ ì‹œ user_id ê²°ì • | API í‚¤ â†’ username ë§¤í•‘ (`.env`) |
| íšŒì›ê°€ì… ì‹œ ê³µê°„ ìë™ ìƒì„± | `ensure_spaces(user_id)` |

---

## 7. íŒ€ì¥ / íŒ€ì› ì—­í•  ë¶„ë¦¬

### ì—­í•  ì •ì˜

`users.role` ì»¬ëŸ¼ìœ¼ë¡œ íŒ€ ë‚´ ì—­í• ì„ êµ¬ë¶„í•©ë‹ˆë‹¤.

| ì—­í•  | íšŒì›ê°€ì… ì„ íƒê°’ | í”„ë¡œí•„ ìˆ˜ì • | ì½”ë©˜íŠ¸ | ê¸°íƒ€ |
|------|---------------|------------|--------|------|
| íŒ€ì¥ | `leader` | ê°€ëŠ¥ | ì‘ì„±Â·ì‚­ì œ ê°€ëŠ¥ | íŒ€ ê³µìœ  í”„ë¡œí•„ ê´€ë¦¬ |
| íŒ€ì› | `member` | ë¶ˆê°€ (ì½ê¸°ë§Œ) | ì‘ì„±Â·ì‚­ì œ ê°€ëŠ¥ | â€” |
| íŒ€ ë¯¸ì†Œì† | `member` | ê°œì¸ í”„ë¡œí•„ ìˆ˜ì • ê°€ëŠ¥ | â€” | â€” |

íšŒì›ê°€ì… ì‹œ ë¼ë””ì˜¤ ë²„íŠ¼ìœ¼ë¡œ ì—­í• ì„ ì„ íƒí•˜ë©°, ê¸°ë³¸ê°’ì€ íŒ€ì›(member)ì…ë‹ˆë‹¤.

### íŒ€ ê³µìœ  í”„ë¡œí•„

íŒ€ ì†Œì† ì‚¬ìš©ìëŠ” ê°œì¸ í”„ë¡œí•„ ëŒ€ì‹  **íŒ€ ê³µìœ  í”„ë¡œí•„**ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

| êµ¬ë¶„ | profiles ì¡°íšŒ í‚¤ | ìˆ˜ì • ê°€ëŠ¥ ì—¬ë¶€ |
|------|-----------------|--------------|
| íŒ€ ì†Œì† | `team_name` | íŒ€ì¥ë§Œ ê°€ëŠ¥ |
| íŒ€ ë¯¸ì†Œì† | `user_id` | ë³¸ì¸ ê°€ëŠ¥ |

ê°™ì€ íŒ€ì˜ íŒ€ì¥Â·íŒ€ì› ëª¨ë‘ ë™ì¼í•œ íŒ€ ê³µìœ  í”„ë¡œí•„ì„ ì¡°íšŒí•©ë‹ˆë‹¤.
íŒ€ì¥ì´ í”„ë¡œí•„ì„ ìˆ˜ì •í•˜ë©´ íŒ€ì›ì´ ì¡°íšŒí•  ë•Œë„ ë³€ê²½ëœ ë‚´ìš©ì´ ì¦‰ì‹œ ë°˜ì˜ë©ë‹ˆë‹¤.

### í”„ë¡œí•„ í˜ì´ì§€ ì ‘ê·¼ ì‹œ ë™ì‘

```
ë¡œê·¸ì¸
  â”‚
  â”œâ”€ íŒ€ ì†Œì† + íŒ€ì¥ â†’ ìˆ˜ì • í¼ í‘œì‹œ, ì €ì¥ ì‹œ team_name í‚¤ë¡œ DB ê°±ì‹ 
  â”œâ”€ íŒ€ ì†Œì† + íŒ€ì› â†’ ì½ê¸° ì „ìš© ë·°, "íŒ€ì¥ë§Œ ìˆ˜ì • ê°€ëŠ¥" ì•ˆë‚´
  â””â”€ íŒ€ ë¯¸ì†Œì†      â†’ ìˆ˜ì • í¼ í‘œì‹œ, ì €ì¥ ì‹œ user_id í‚¤ë¡œ DB ê°±ì‹ 
```

### ê¸°ì¡´ ê³„ì • ì—­í•  ë³€ê²½ ë°©ë²•

sqlite3 CLIë¥¼ ì§ì ‘ ì‚¬ìš©í•©ë‹ˆë‹¤.

```
sqlite3 data/bidflow.db
> UPDATE users SET role='leader' WHERE username='ì‚¬ìš©ìëª…';
```
